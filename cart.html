<!doctype html>
<html lang="en">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Bootstrap CSS -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
      <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
      <link rel="stylesheet" href="./css/cartStyle.css">
      <title>GreatMealz - Checkout</title>
      <style>
         #map {
             width: 100%;
             height: 200px;
         }
     </style>
   </head>
   <body>
      <!-- NAVBAR -->
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
         <div class="container-fluid">
            <a class="navbar-brand" href="#">
            <img src="./img/logo.png" alt="logo" style="width:120px">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
               <ul class="navbar-nav">
                  <li class="nav-item">
                     <a class="nav-link" href="list.html">Volver a la orden</a>
                  </li>
               </ul>
            </div>
            <div class="collapse navbar-collapse end-0" id="navbarNav" style="margin-left: 70%;">
               <ul class="navbar-nav">
                  <li class="nav-item">
                     <a class="nav-link" href="home.html">Salir</a>
                  </li>
               </ul>
            </div>
         </div>
      </nav>
      <!-- END NAVBAR -->
      <!-- CART -->
      <div class="container mt-5 p-3 rounded cart">
         <div class="row no-gutters">
            <div class="col-md-8">
               <div class="product-details mr-2">
                  <hr>
                  <h6 class="mb-0">Carrito de compras</h6>
                  <div id="divCartList">

                  </div>
               </div>
            </div>
            <div class="col-md-4">
               <div class="payment-info">
                  <div class="d-flex justify-content-between align-items-center"><span>Forma de entrega y pago</span></div>
                  <span class="type d-block mt-3 mb-1">Delivery</span>
                  <label class="radio" onclick='setTotal(50, "none")'> <input type="radio" name="ship" value="delivery"> <span><img width="30" src="https://img.icons8.com/cotton/48/000000/delivery-scooter--v2.png"/></span> </label>
                  <label class="radio" class="mt-4" onclick='setTotal(0, "block")'> <input type="radio" name="ship" value="delivery"> <span><img width="30" src="https://img.icons8.com/cotton/48/000000/pickup-point.png" /></span> </label>
                  <div id="map" style="display: none;"></div>
                  <span class="type d-block mt-3 mb-1">Payment Method</span>
                  <label class="radio" onclick="togglePaymentMethod(false)"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/cotton/48/000000/money--v4.png"/></span> </label>
                  <label class="radio" onclick="togglePaymentMethod(true)"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/color/48/000000/mastercard.png" /></span> </label>
                  <label class="radio" onclick="togglePaymentMethod(true)"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/officel/48/000000/visa.png" /></span> </label>
                  <label class="radio" onclick="togglePaymentMethod(false)"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/officel/48/000000/paypal.png" /></span> </label>
                  <label class="radio" onclick="togglePaymentMethod(false)"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/offices/48/000000/bitcoin.png" /></span> </label>
                  <div style="display: none;" id="divCard">
                     <div><label class="credit-card-label">Nombre en la tarjeta</label><input type="text" class="form-control credit-inputs" placeholder="Nombre"></div>
                     <div><label class="credit-card-label">Número de tarjeta</label><input type="number" class="form-control credit-inputs" placeholder="0000 0000 0000 0000"></div>
                     <div class="row">
                        <div class="col-md-6"><label class="credit-card-label">Fecha </label><input type="number" class="form-control credit-inputs" placeholder="00/00"></div>
                        <div class="col-md-6"><label class="credit-card-label">CVV</label><input type="number" class="form-control credit-inputs" placeholder="000"></div>
                     </div>
                  </div>
                  <hr class="line">
                  <div class="d-flex justify-content-between information"><span>Subtotal</span><span id="spnSubTotal"></span></div>
                  <div class="d-flex justify-content-between information"><span>Entrega</span><span id="spnEntrega">$ </span></div>
                  <div class="d-flex justify-content-between information"><span>Total</span><span id="spnTotal"></span></div>
                  <button onclick="redirect()" class="btn btn-warning btn-block d-flex justify-content-between mt-3" type="button"><span>¡Ordenar ahora!<i class="fa fa-long-arrow-right ml-1"></i></span></button>
               </div>
            </div>
            
         </div>
         
      </div>
      
      <!-- CART -->
      

      <script src="./js/cart.js"></script>

      <!-- Google Maps -->
      <script
         src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnY8kMwai0w66KFgVDfGoFom4BfJ-hkM0&callback=iniciaMapa"
         async defer></script>
      <!-- SCRIPTS -->
      <!-- Bootstrap Bundle with Popper  -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
      <!-- AOS  -->
      <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
      <script>
         AOS.init();
      </script>
      <!-- SWAL -->
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.0/dist/sweetalert2.all.min.js"></script>

      <!-- FIREBASE -->
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js" ></script>
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js" ></script>
      <script src="./js/firebase.js"></script>
      <script>
         var _total = 0;
         var divCartList = document.getElementById("divCartList");
         const cartItems = JSON.parse(localStorage.getItem('cart'));
         console.log(cartItems)
         var loadCartItems = () => {
         var subTotal = 0;
         cartItems.forEach(item => {
            console.log(item)
            var i = '<div class="d-flex justify-content-between align-items-center mt-3 p-2 items rounded">'
                + '<div class="d-flex flex-row">'
                + '<div class="ml-2"><span class="font-weight-bold d-block">'
                + item.name
                + '</span><span class="spec">'
                + item.description
                + '</span></div>'
                + '</div>'
                + '<div class="d-flex flex-row align-items-center"><span class="d-block ml-5 font-weight-bold">$'+
                + item.cost
                +'</span><i class="fa fa-trash-o ml-3 text-black-50"></i></div></div>';
              divCartList.innerHTML += i;
              subTotal += Number(item.cost)
              
          });
          console.log(subTotal);
          spnSubTotal.innerHTML = `$ ${subTotal}`;
          _total = subTotal;
          //spnTotal.innerHTML = `$ ${subTotal + 50}`;
        }

        var setTotal = (value, style) => {
         spnTotal.innerHTML = `$ ${_total + value}`;
         spnEntrega.innerHTML=`$ ${value}`;
         document.getElementById("map").style.display = style;
        }

        var redirect = () => {
         Swal.fire({
            icon: 'success',
            title: '¡Gracias!',
            text: '¡Su orden ha sido recibida!',
            confirmButtonText: `Continuar`,
         }).then((result) => {
            cartItems.forEach((doc) => {
               let docRef = db.collection("mealz").doc(); 
               batch.set(docRef, doc);
            });
            batch.commit().then(() => {
               window.location.href = "list.html"
               localStorage.setItem('cart', JSON.stringify([]))
            })

         })
        }

        loadCartItems();
      </script>
   </body>
</html>